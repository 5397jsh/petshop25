<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.sm.repository.PaymentInfoRepository">

    <select id="selectByCustId" parameterType="String" resultType="edu.sm.dto.PaymentInfo">
        SELECT * FROM payment_info WHERE cust_id = #{custId}
    </select>

    <insert id="insertOrUpdate" parameterType="edu.sm.dto.PaymentInfo">
        INSERT INTO payment_info (cust_id, card_name, card_number, exp_month, exp_year, cvv)
        VALUES (#{custId}, #{cardName}, #{cardNumber}, #{expMonth}, #{expYear}, #{cvv})
            ON DUPLICATE KEY UPDATE
                                 card_name = VALUES(card_name),
                                 card_number = VALUES(card_number),
                                 exp_month = VALUES(exp_month),
                                 exp_year = VALUES(exp_year),
                                 cvv = VALUES(cvv),
                                 reg_date = NOW()
    </insert>
</mapper>
