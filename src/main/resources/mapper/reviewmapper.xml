<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.sm.repository.ReviewRepository">

    <!-- 상품별 리뷰 목록 -->
    <select id="selectByProduct" parameterType="int" resultType="edu.sm.dto.Review">
        SELECT
            review_id       AS reviewId,
            product_id      AS productId,
            cust_id         AS custId,
            rating          AS rating,
            review_comment  AS comment,
            comm_date       AS commDate
        FROM reviews
        WHERE product_id = #{productId}
        ORDER BY comm_date DESC
    </select>

    <!-- 리뷰 단일 조회 -->
    <select id="select" parameterType="int" resultType="edu.sm.dto.Review">
        SELECT
            review_id       AS reviewId,
            product_id      AS productId,
            cust_id         AS custId,
            rating          AS rating,
            review_comment  AS comment,
            comm_date       AS commDate
        FROM reviews
        WHERE review_id = #{reviewId}
    </select>

    <!-- 리뷰 등록 -->
    <insert id="insert" parameterType="edu.sm.dto.Review" useGeneratedKeys="true" keyProperty="reviewId">
        INSERT INTO reviews
            (product_id, cust_id, rating, review_comment, comm_date)
        VALUES
            (#{productId}, #{custId}, #{rating}, #{comment}, NOW())
    </insert>

    <!-- 리뷰 수정 -->
    <update id="update" parameterType="edu.sm.dto.Review">
        UPDATE reviews
        SET
            rating         = #{rating},
            review_comment = #{comment}
        WHERE review_id = #{reviewId}
    </update>

    <!-- 리뷰 삭제 -->
    <delete id="delete" parameterType="int">
        DELETE FROM reviews
        WHERE review_id = #{reviewId}
    </delete>

</mapper>